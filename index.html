<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Liseuse">
  <meta name="theme-color" content="#f2f0eb">
  <title>Liseuse — PDF Read Aloud</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">

  <!-- Apple touch icon -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='90' fill='%23f2f0eb'/><text x='256' y='340' font-size='280' text-anchor='middle' font-family='Georgia,serif' fill='%23c45d3e'>L</text></svg>">

  <!-- Styles -->
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

  <!-- Hidden file input -->
  <input type="file" id="file-input" accept="application/pdf" hidden>

  <!-- ═══ Welcome Screen ═══ -->
  <div id="welcome-screen">
    <div class="welcome-icon"><span>L</span></div>
    <div class="welcome-title">Liseuse</div>
    <div class="welcome-sub">Open a PDF and listen to it<br>read aloud in French or English</div>
    <button class="welcome-btn" id="welcome-import-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Open PDF
    </button>
  </div>

  <!-- ═══ Top Bar ═══ -->
  <header id="top-bar">
    <button class="bar-btn" id="top-import-btn" aria-label="Import PDF">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>

    <div id="doc-title">Liseuse</div>

    <button id="lang-toggle" aria-label="Toggle language">FR</button>

    <button class="bar-btn" id="voice-menu-btn" aria-label="Voice selection">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/>
      </svg>
    </button>
  </header>

  <!-- ═══ Reader Area ═══ -->
  <main id="reader-area"></main>

  <!-- ═══ Loading Overlay ═══ -->
  <div id="loading-overlay" class="hidden">
    <div class="spinner"></div>
    <div class="loading-text">Loading PDF…</div>
  </div>

  <!-- ═══ Bottom Player Bar ═══ -->
  <footer id="bottom-bar">
    <button class="player-btn" id="play-btn" aria-label="Play or Pause">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5.14v13.72a1 1 0 001.5.86l11-6.86a1 1 0 000-1.72l-11-6.86A1 1 0 008 5.14z"/>
      </svg>
    </button>

    <button class="player-btn" id="stop-btn" aria-label="Stop">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <rect x="6" y="6" width="12" height="12" rx="2"/>
      </svg>
    </button>

    <div class="speed-control">
      <input type="range" id="speed-slider" min="0.8" max="2.0" step="0.1" value="1.0">
      <span id="speed-display">1.0×</span>
    </div>

    <!-- New: progress bar + page label -->
    <div class="progress-area">
      <div class="progress-bar-track">
        <div class="progress-bar-fill" id="progress-bar-fill"></div>
      </div>
      <div class="progress-label" id="progress-label">—</div>
    </div>
  </footer>

  <!-- ═══ Voice Selection Menu ═══ -->
  <div id="voice-menu-overlay">
    <div id="voice-menu">
      <div class="voice-menu-handle"></div>
      <div class="voice-menu-title">Select Voice</div>
      <div id="voice-menu-list"></div>
    </div>
  </div>

  <!-- ═══ Scripts ═══ -->
  <script type="module">
    import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs';
    window.pdfjsLib = pdfjsLib;

    const script = document.createElement('script');
    script.src = './app.js';
    document.body.appendChild(script);
  </script>

</body>
</html>
